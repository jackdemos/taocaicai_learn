# JAVA面试

## 基础部分

1. JAVA中的几种基本数据类型是什么,各自占用多少字节，Integer占几个字节.

   八种基本数据类型,int(4),short(2),byte(1),long(8),float(4),double(8),char(2),boolean(1)
   Integer占用
   32位：Header(标记头4字节 + 对象指针4字节） + int(4字节）+ 对齐（4) = 16字节
   64位：Header(标记头8字节 + 对象指针8字节） + int(4字节）+ 对齐（4) = 24字节
   64位（开启指针压缩）：Header(标记头8字节 + 对象指针4字节） + int(4字节）+ 对齐（0) = 16字节

2. String类能被继承吗,为什么.

   String是一个被final修饰的类,不能被继承

3. String、StringBuffer、 StringBuilder 的区别.


4. ArrayList 和 LinkedList 有什么区别.

   ArrayList底层是数组实现,具有数组的特性,增删慢,查询快
   LinkedList底层是采用链表来实现,增删快,查询慢

5. 讲讲类的实例化顺序,比如父类静态数据,构造函数,字段,子类静态数据,构造函数,字段,当new的时候,他们的执行顺序.

   类的实例化顺序：先静态再父子
   父类静态数据->子类静态数据->父类字段->子类字段->父类构造函数->子类构造函数

6. 用过哪些Map类,都有什么区别,HashMap是线程安全的吗,并发下使用的Map是什么,他们内部原理分别是什么,比如存储方式,hashcode,扩容,默认容量等.

   最常用的Map实现类有:HashMap,ConcurrentHashMap(jdk1. 8),LinkedHashMap,TreeMap,Hashtable；
   其中最频繁的是HashMap和ConcurrentHashMap,他们的主要区别是HashMap是非线程安全的.ConcurrentHashMap是线程安全的.
   并发下可以使用ConcurrentHashMap和Hashtable,他们的主要区别是：
   (1). ConcurrentHashMap的hash计算公式：(key. hascode()^ (key. hascode()>>> 16)) & 0x7FFFFFFF
   Hashtable的hash计算公式：key. hascode()& 0x7FFFFFFF
   (2). Hashtable存储方式都是链表+数组,数组里面放的是当前hash的第一个数据,链表里面放的是hash冲突的数据

   (3). 默认容量都是16,负载因子是0.75.就是当hashmap填充了75%的busket是就会扩容,最小的可能性是(16*0. 75),一般为原内存的2倍
   (4). 线程安全的保证：Hashtable是在每个操作方法上面加了synchronized来达到线程安全,ConcurrentHashMap线程是使用CAS(compore and swap)来保证线程安全的

7. JAVA8的ConcurrentHashMap为什么放弃了分段锁,有什么问题吗,如果你来设计,你如何设计.

   jdk8 放弃了分段锁而是用了Node锁,减低锁的粒度,提高性能,并使用CAS操作来确保Node的一些操作的原子性,取代了锁.
   但是ConcurrentHashMap的一些操作使用了synchronized锁,而不是ReentrantLock,虽然说jdk8的synchronized的性能进行了优化，但是我觉得还是使用ReentrantLock锁能更多的提高性能(优先使用synchronized,虚拟机一直在优化这个锁)

8. 有没有有顺序的Map实现类,如果有,他们是怎么保证有序的.

   顺序的Map实现类:LinkedHashMap,TreeMap
   LinkedHashMap是基于元素进入集合的顺序或者被访问的先后顺序排序,TreeMap 则是基于元素的固有顺序(默认是hashcode,可以实现Comparable自定义排序规则).

9. 抽象类和接口的区别,类可以继承多个类么,接口可以继承多个接口么,类可以实现多个接口么.

   抽象类有构造方法,接口没有;抽象类中可以有方法的实现(8以后接口也可以了,default方法),类只能单继承,接口可以继承多个接口,类可以实现多个接口

10. 继承和组合的区别在哪.

    继承指的是一个类继承另外的一个类的功能,并可以增加它自己的新功能的能力,继承是类与类或者接口与接口之间最常见的关系；在Java中此类关系通过关键字extends明确标识.
    聚合体现的是整体与部分,拥有的关系,此时整体与部分之间是可分离的,他们可以具有各自的生命周期；比如计算机与CPU,公司与员工的关系等；

11. IO模型有哪些,讲讲你理解的nio ,他和bio,aio的区别是啥,谈谈reactor模型.

    BIO：同步阻塞式IO,服务器实现模式为一个连接一个线程,即客户端有连接请求时服务器端就需要启动一个线程进行处理,如果这个连接不做任何事情会造成不必要的线程开销,当然可以通过线程池机制改善.
    NIO：同步非阻塞式IO,服务器实现模式为一个请求一个线程,即客户端发送的连接请求都会注册到多路复用器上,多路复用器轮询到连接有I/O请求时才启动一个线程进行处理.
    reactor模型：反应器模式(事件驱动模式)：当一个主体发生改变时,所有的属体都得到通知,类似于观察者模式.

12. 反射的原理,反射创建类实例的三种方式是什么.

    反射的原理：如果知道一个类的名称/或者它的一个实例对象, 就能把这个类的所有方法和变量的信息(方法名,变量名,方法,修饰符,类型,方法参数等等所有信息)找出来.

    反射创建类实例的三种方式：
    Class.forName("com.A");
    new A().getClass();
    A.class;

13. 反射中Class.forName和ClassLoader区别

    class.forName()除了将类的.class文件加载到jvm中之外,还会对类进行解释,执行类中的static块.
    classLoader只干一件事情,就是将.class文件加载到jvm中,不会执行static中的内容,只有在newInstance才会去执行static块.

14. 描述动态代理的几种实现方式,分别说出相应的优缺点.

    动态代理有两种实现方式,分别是：jdk动态代理和cglib动态代理
    jdk动态代理的前提是目标类必须实现一个接口,代理对象跟目标类实现一个接口,从而避过虚拟机的校验.
    cglib动态代理是继承并重写目标类,所以目标类和方法不能被声明成final.

15. 动态代理与cglib实现的区别.

    动态代理有两种实现方式,分别是：jdk动态代理和cglib动态代理
    jdk动态代理的前提是目标类必须实现一个接口,代理对象跟目标类实现一个接口,从而避过虚拟机的校验.
    cglib动态代理是继承并重写目标类,所以目标类和方法不能被声明成final.

16. 为什么CGlib方式可以对接口实现代理.

    cglib动态代理是继承并重写目标类,所以目标类和方法不能被声明成final.而接口是可以被继承的.

17. final的用途.

    1). final修饰的对象不能被修改；
    2). final修饰的类不能被继承；
    3). final修饰的方法不能被重写；

18. 写出三种单例模式实现.

    懒汉式(先定义,用的时候再创建),饿汉式(定义并创建好,用的时候直接拿),饱汉式(静态内部类,枚举)

19. 如何在父类中为子类自动完成所有的hashcode和equals实现?这么做有何优劣.

    父类的equals不一定满足子类的equals需求.比如所有的对象都继承Object,默认使用的是Object的equals方法,在比较两个对象的时候,是看他们是否指向同一个地址.
    但是我们的需求是对象的某个属性相同,就相等了,而默认的equals方法满足不了当前的需求,所以我们要重写equals方法.
    如果重写了equals 方法就必须重写hashcode方法,否则就会降低map等集合的索引速度.

20. 请结合OO设计理念,谈谈访问修饰符public,private,protected,default在应用设计中的作用.


21. 深拷贝和浅拷贝区别.

    浅拷贝只拷贝指针,深拷贝就是拷贝他的值,重新生成的对象.

22. 数组和链表数据结构描述,各自的时间复杂度.


23. error和exception的区别,CheckedException,RuntimeException的区别.


24. 请列出5个运行时异常.


25. 在自己的代码中,如果创建一个java.lang.String类,这个类是否可以被类加载器加载?为什么.

    不可以,双亲委派模式会保证父类加载器先加载类,就是BootStrap(启动类)加载器加载jdk里面的java.lang.String类,而自定义的java.lang.String类永远不会被加载到

26. 说一说你对java.lang.Object对象中hashCode和equals方法的理解.在什么场景下需要重新实现这两个方法.


27. 在jdk1.5中,引入了泛型,泛型的存在是用来解决什么问题.

    泛型的好处是在编译的时候检查类型安全,并且所有的强制转换都是自动和隐式的,提高代码的重用率.

28. 这样的a.hashcode()有什么用,与a.equals(b)有什么关系.

    hashCode()方法是相应对象整型的 hash值.它常用于基于hash的集合类,如Hashtable,HashMap,LinkedHashMap等等.它与 equals() 方法关系特别紧密.根据 Java 规范,两个使用 equal() 方法来判断相等的对象,必须具有相同的 hash code.

29. 有没有可能2个不相等的对象有相同的hashcode.

    有可能,最简单的方法,百分百实现的方式就是重写hascode();

30. Java中的HashSet内部是如何工作的.

    HashSet的内部采用 HashMap来实现.由于Map需要key和value,所以HashSet中所有key的都有一个默认value.类似于 HashMap,HashSet 不允许重复的 key,只允许有一个null key,意思就是 HashSet 中只允许存储一个null对象.

31. 什么是序列化,怎么序列化,为什么序列化,反序列化会遇到什么问题,如何解决.

    序列化：把对象转换为字节序列的过程称为对象的序列化.
    反序列化：把字节序列恢复为对象的过程称为对象的反序列化.
    详细：https://blog.csdn.net/riemann_/article/details/87835260

32. java8的新特性.

33. 讲讲SPI机制

    破环双亲委派模型的经典方法(上下文context)，jdbc驱动，dubbo，springboot都有，把依赖的第三方的jar包通过外部路径加载

## JVM知识

1. 什么情况下会发生栈内存溢出.

   https://blog.csdn.net/qq_31615049/article/details/82980799

2. JVM的内存结构,Eden和Survivor比例.


3. JVM内存为什么要分成新生代,老年代,持久代.新生代中为什么要分为Eden和Survivor.

4. JVM中一次完整的gc流程是怎样的,对象如何晋升到老年代,说说你知道的几种主要的JVM参数.

5. 你知道哪几种垃圾收集器,各自的优缺点,重点讲下cms和G1,包括原理,流程,优缺点.

6. 垃圾回收算法的实现原理.

7. 当出现了内存溢出,你怎么排错.

8. JVM内存模型的相关知识了解多少,比如重排序,内存屏障,happen-before,主内存,工作内存等.

9. 简单说说你了解的类加载器,可以打破双亲委派么,怎么打破.

10. 讲讲JAVA的反射机制.

11. 你们线上应用的JVM参数有哪些.

12. g1和cms区别,吞吐量优先和响应优先的垃圾收集器选择(最新有个Zgc,可以了解下).

13. 怎么打出线程栈信息.

14. 请解释如下jvm参数的含义：


15. 用过那些jdk工具排查问题


    排查oom可以使用eclipse的mat工具分析内存

## 开源框架知识

1. spring的循环依赖

   三级缓存，具体自己看一下

2. spring beanFactory和factoryBean区别

3. spring ioc和aop的原理.

4. 讲讲spring事务的传播属性，transaction注解原理.

5. spring的beanpostprocesser和refresh方法

6. spring和springboot区别，了解springboot的pom吗

7. springboot是怎么集成tomcat的?

8. zookeeper的原理

   zab协议，崩溃恢复和日志同步

9. 用过的rpc框架，dubbo的原理

10. 了解k8s_docker吗，宿主机怎么查看docker进程，k8s自动扩容的原理

## 操作系统

1. Linux系统下你关注过哪些内核参数,说说你知道的.

2. Linux下IO模型有几种,各自的区别是什么.

   select poll epoll

3. 终止进程ctrl+c发生了什么

4. 平时用到哪些Linux命令.

   netstat查看网络
   iostat 查看io
   lsof 查看端口
   free 查看内存，了解几个区别
   df du 参看磁盘
   grep 查找文件内容 find查找文件
   ps查看进程
   less more cat tail查看文件
   chmod修改权限

5. 用一行命令查看文件的最后五行.

   tail -5 file.txt

6. 用一行命令输出正在运行的java进程.

   jps -lvm

7. 介绍下你理解的操作系统中线程切换过程.

8. 进程和线程的区别.

9. top命令之后有哪些内容,有什么作用.

   查看当前cpu的负载，内存使用率

10. 线上CPU爆高,请问你如何找到问题所在.

    死循环或者频繁fullgc
    top -pH按当前线程cpu负载从高到低显示

11. 一个日志文件里面都是ip信息，打印出现频率最高的5个ip倒序输出

## 多线程

1. 多线程的几种实现方式,什么是线程安全.

2. volatile的原理,作用,能代替锁么.

   保证可见性和有序性,不保证原子性

3. 画一个线程的生命周期状态图.

4. sleep和wait的区别.

5. sleep和sleep(0)的区别.

6. Lock与Synchronized的区别.

7. synchronized的原理是什么,一般用在什么地方(比如加在静态方法和非静态方法的区别,静态方法和非静态方法同时执行的时候会有影响吗),解释以下名词：重排序,自旋锁,偏向锁,轻量级锁,可重入锁,公平锁,非公平锁,乐观锁,悲观锁.

8. 用过哪些原子类,他们的原理是什么.

9. 实现一个生产者消费者模式,不用阻塞队列

10. JUC下研究过哪些并发工具,讲讲原理.

11. 用过线程池吗,如果用过,请说明原理,并说说newCache和newFixed有什么区别,构造函数的各个参数的含义是什么,比如coreSize,maxsize等.

12. 线程池的关闭方式有几种,各自的区别是什么.

13. 假如有一个第三方接口,有很多个线程去调用获取数据,现在规定每秒钟最多有10个线程同时调用它,如何做到.

14. spring的controller是单例还是多例,怎么保证并发的安全.

15. 用三个线程按顺序循环打印abc三个字母,比如abcabcabc.

16. ThreadLocal用过么,用途是什么,原理是什么,用的时候要注意什么.

    ThreadLocalMap 防止内存泄漏

17. 如果让你实现一个并发安全的链表,你会怎么做.

18. 有哪些无锁数据结构,他们实现的原理是什么.

19. 讲讲java同步机制的wait和notify.

20. CAS机制是什么,如何解决ABA问题.

21. 多线程如果线程挂住了怎么办.

22. countdowlatch和cyclicbarrier的内部原理和用法,以及相互之间的差别(比如countdownlatch的await方法和是怎么实现的).

23. 对AbstractQueuedSynchronizer了解多少,讲讲加锁和解锁的流程,独占锁和公平所加锁有什么不同.

24. 使用synchronized修饰静态方法和非静态方法有什么区别.

25. 简述ConcurrentLinkedQueue和LinkedBlockingQueue的用处和不同之处.

26. 导致线程死锁的原因?怎么解除线程死锁.

    死锁的四个必要条件: 请求和保持,不可剥夺,互斥,循环等待
    保证加锁顺序一致避免循环等待

27. 非常多个线程(可能是不同机器),相互之间需要等待协调,才能完成某种工作,问怎么设计这种协调方案.

28. 用过读写锁吗,原理是什么,一般在什么场景下用.

    读锁共享,写锁互斥.读阻塞写,写阻塞读写,读之前互相不阻塞 持有写锁的线程可以获取读锁,完成锁降级

29. 开启多个线程,如果保证顺序执行,有哪几种实现方式,或者如何保证多个线程都执行完再拿到结果.

30. 延迟队列的实现方式,delayQueue和时间轮算法的异同.

## TCP与HTTP

1. http1.0, http1.1, http2.0有什么区别.

   http1.0一个请求对应一个线程

2. TCP三次握手和四次挥手的流程,为什么断开连接要4次,如果握手只有两次,会出现什么.

3. TIME_WAIT和CLOSE_WAIT的区别.

4. 说说你知道的几种HTTP响应码,比如200, 302, 404.

5. 当你用浏览器打开一个链接(如：http://www.javastack.cn)的时候,计算机做了哪些工作步骤.

6. TCP如何保证可靠性,说说TCP头的结构.

7. 如何避免浏览器缓存.

8. 如何理解HTTP协议的无状态性.

9. 简述Http请求get和post的区别以及数据包格式.

10. HTTP有哪些method

11. 简述HTTP请求的报文格式.

12. HTTP的长连接是什么意思.

13. HTTPS的加密方式是什么,讲讲整个加密解密流程.

14. Http和https的三次握手有什么区别.

15. 什么是分块传送.

16. Session和cookie的区别.

## 架构设计与分布式

1. 用java自己实现一个LRU.


2. 分布式集群下如何做到唯一序列号.

   雪花算法(snowflake)

3. 设计一个秒杀系统,30分钟没付款就自动关闭交易.

4. 如何使用redis和zookeeper实现分布式锁?有什么区别优缺点,会有什么问题,分别适用什么场景.(延伸：如果知道redlock,讲讲他的算法实现,争议在哪里)

5. 如果有人恶意创建非法连接,怎么解决.

6. 分布式事务的原理,优缺点,如何使用分布式事务,2pc 3pc 的区别,解决了哪些问题,还有哪些问题没解决,如何解决,你自己项目里涉及到分布式事务是怎么处理的.

7. 什么是一致性hash.

8. 什么是restful,讲讲你理解的restful.

9. 如何设计一个良好的API.

10. 如何设计建立和保持100w的长连接.

11. 解释什么是MESI协议(缓存一致性).

12. 说说你知道的几种HASH算法,简单的也可以.

13. 什么是paxos算法, 什么是zab协议和raft协议.

14. 一个在线文档系统,文档可以被编辑,如何防止多人同时对同一份文档进行编辑更新.

15. 线上系统突然变得异常缓慢,你如何查找问题.

16. 说说你平时用到的设计模式.

17. Dubbo的原理,有看过源码么,数据怎么流转的,怎么实现集群,负载均衡,服务注册和发现,重试转发,快速失败的策略是怎样的 .

18. 一次RPC请求的流程是什么.

19. 自己实现过rpc么,原理可以简单讲讲.Rpc要解决什么问题.

20. 异步模式的用途和意义.

21. 编程中自己都怎么考虑一些设计原则的,比如开闭原则,以及在工作中的应用.

22. 设计一个社交网站中的“私信”功能,要求高并发,可扩展等等. 画一下架构图.

23. MVC模式,即常见的MVC框架.

24. 聊下曾经参与设计的服务器架构并画图,谈谈遇到的问题,怎么解决的.

25. 应用服务器怎么监控性能,各种方式的区别.

26. 如何设计一套高并发支付方案,架构如何设计.

27. 如何实现负载均衡,有哪些算法可以实现.

28. Zookeeper的用途,选举的原理是什么.

29. Zookeeper watch机制原理.

30. mybatis的底层实现原理.

31. 请思考一个方案,实现分布式环境下的countDownLatch.

32. 后台系统怎么防止请求重复提交.

    接口实现幂等

33. 描述一个服务从发布到被消费的详细过程.

34. 讲讲你理解的服务治理.

35. 如何做到接口的幂等性.

36. 如何做限流策略,令牌桶和漏斗算法的使用场景.

37. 什么叫数据一致性,你怎么理解数据一致性.

38. 分布式服务调用方,不依赖服务提供方的话,怎么处理服务方挂掉后,大量无效资源请求的浪费,如果只是服务提供方吞吐不高的时候该怎么做,如果服务挂了,那么一会重启,该怎么做到最小的资源浪费,流量半开的实现机制是什么.

39. dubbo的泛化调用怎么实现的,如果是你,你会怎么做.

40. 远程调用会有超时现象,如果做到优雅的控制,JDK自带的超时机制有哪些,怎么实现的.

## 数据库知识

1. mysql索引失效的原则

2. mysql的锁，行锁，表锁，乐观锁，悲观锁，共享锁，排他锁

3. mysql myisam和innodb存储引擎区别

4. mysql的事务隔离级别，rr和rc

5. mysql的acid，以及分别实现acid的底层原理

6. mysql的log, binlog redolog undolog

7. mysql怎么解决幻读的

8. mysql的mvvc原理，在rr和rc的实现区别

9. 聚集索引和非聚集索引的区别

10. b树和b+树的区别，为什么用b+树不用平衡二叉树，简单计算b+树为什么只有三四层

11. 最左前缀原则， 索引怎么设计

12. 多主怎么同步数据， 主从模式数据同步

## 消息队列

1. kafka的架构介绍

2. kafka为什么吞吐量高，几个优化

3. kafka怎么实现exactly one

4. kafka怎么保证消息有序

5. kafka的幂等和offset什么时候提交

6. zk在kafka的作用， kafka有那些log

## 缓存

1. 常见的缓存策略有哪些,如何做到缓存与DB的数据一致性

2. 如何防止缓存击穿和雪崩

3. Redis的五种数据结构，跳表实现，hash表的扩容

4. redis集群方案， 哨兵模式的优缺点

5. redis的分布式锁， 介绍redisson

6. redis的大key 热key问题 pipeline原理

7. redis的事件模型，key的删除策略

## 搜索

1. elasticsearch了解多少,说说你们公司es的集群架构,索引数据大小,分片有多少,以及一些调优手段.elasticsearch的倒排索引是什么.

2. elasticsearch 索引数据多了怎么办,如何调优,部署.

3. elasticsearch是如何实现master选举的.

4. 详细描述一下Elasticsearch索引文档的过程.

5. 详细描述一下Elasticsearch搜索的过程.

6. Elasticsearch在部署时,对Linux的设置有哪些优化方法?

7. lucence内部结构是什么.

## 算法题 (Leetcode top200)

1. 环形链表的第一个环节点

2. 只有0和1的数组排序

   双指针交换 O(n)时间，O(1)空间

3. 两个链表的第一个相交节点

4. 合并两个有序链表，合并多个有序链表

5. 生成全排列

6. 山脉数组最大值(先增后减有重复)

7. 合并有序数组a和b，a有足够空间，不新申请空间合并

8. 有序数组不同平方的数字

9. 打印树指定和的路径

10. 字符串删除k个数的最大数

11. 树的层次遍历

12. 1-n号个人 1-n号个灯 开始灯关的如果灯的编号能被人的编码整除按一下开关，对于1-n的灯都有1-n的人经过最后那些灯亮

13. ip地址转数字

14. 编辑距离，两个矩形交叉面积，链表倒序k组翻转，种子填充，三个有序链表公共数

## 场景题

1. 设计一个限流器

   漏桶和令牌桶，主要是令牌桶的滑动窗口

2. 服务器有很多ip只能加四个白名单，怎么解决?

   用代理解决

3. 如果高并发服务缓存挂了，db被打挂，怎么重启服务，因为缓存挂了db重启还会挂掉

   服务降级，限流走消息队列，下来想了下可以预热新缓存集群(缓存走持久化策略)然后再重启db(面试官不满意，我自己搜总结的，你再瞅瞅)

4. 分库分表的跨表查询方案优化

   一个是缓存查询数据，另一个方案就是维护冗余的全量数据表

5. 多服务器共用一个第三方业务的token，第三方定期更新

   我的方案是token放redis缓存， 分布式定时任务更新，引入zk，只有leader的机器才会执行获取最新token(可以提供rpc接口更新触发回调，监控半个小时没有更新报警，我自己想的)

6. 在线业务线程池的参数设置

   基于响应时间和吞吐量，最后做成动态配置参数
   https://blog.csdn.net/ailiandeziwei/article/details/105477933

7. 四核机器怎么保证cpu占用率50%

   启动两个线程的死循环任务

8. 设计文件系统，支持增加删除，修改文件(夹)，按时间到序列查询文件夹下面所有文件(夹)，给表设计


9. 国庆节滴滴挂了，什么问题，怎么解决

   这个我不了解，没回答好

## 项目梳理

讲项目的技术难点，除了业务我总结出了我项目的两个难点

1. 乐观锁解决幂等并发更新(updateTime，行业方案是version)

2. 维护两套redis缓存做高可用

3. 谈项目架构，多级缓存设计，分库分表，一些功能的表设计，对具体业务的细节理解